# Astro Session Analyser - Ekos Edition

Astrophotography session analyzer specialized for **Ekos/KStars**. This application analyzes `.analyze` files generated by Ekos and sends detailed summaries to Discord at the end of each observation night.

## ğŸŒŸ Features

### Core Features
- **Native Ekos Analysis**: Directly parses KStars/Ekos `.analyze` files
- **Detailed Statistics**: HFR, star count, temperature, autofocus
- **Problem Detection**: Aborted captures, session issues
- **Rich Discord Summary**: Rich format with emojis and organized statistics
- **Flexible Configuration**: Customizable path to Ekos logs

### ğŸš€ Advanced Features
- **3 Simple Report Levels**: From minimal notifications to detailed analysis
- **Advanced Statistical Metrics**: Temperature correlations, quality scoring, efficiency analysis
- **Intelligent Alerts**: Automatic detection of performance issues
- **Scientific Analysis**: Statistical significance testing with NumPy/SciPy
- **Unified Configuration**: Single config file supporting all features
- **Dry-Run Mode**: Safe testing without sending to Discord

## ğŸ“Š Report Levels

### ğŸ“± **MINIMAL** - Quick Notifications
- Ultra-rapid notifications with essential info
- Session conditions and autofocus summary
- Critical alerts only
- Perfect for automated monitoring

### ğŸ“Š **STANDARD** - Daily Usage (Default)
- Balanced format with comprehensive information
- Capture details by object/filter
- Session conditions and autofocus analysis
- Issues and alerts summary

### ğŸ”¬ **DETAILED** - Data Lover Mode
- **Automatically enables advanced analytics**
- Statistical quality analysis with correlations
- Performance and efficiency metrics
- Temperature-HFR correlation analysis
- Quality scoring (0-100) and productivity metrics
- Comprehensive alerts and recommendations

## ğŸ“‹ Requirements

- Python 3.7+
- KStars/Ekos configured to generate analyze files
- Discord webhook configured
- **For DETAILED level**: NumPy/SciPy for advanced analytics

## ğŸš€ Installation

1. **Clone the repository**
```bash
git clone https://github.com/grm/astro-session-analyser
cd astro-session-analyser
```

2. **Install dependencies**
```bash
# Basic installation (minimal & standard levels)
pipenv install

# For detailed level with advanced analytics
pipenv install numpy scipy
```

3. **Configure the application**
```bash
# Copy example configuration
cp config_example.yml config.yml

# Edit config.yml with your settings
```

## âš™ï¸ Configuration

### Simple Configuration

Edit the `config.yml` file:

```yaml
# Discord webhook URL
webhook: "https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN"

# Time window in hours to analyze sessions
hours: 24

# Path to Ekos analyze files (optional)
# Default: ~/.local/share/kstars/analyze
analyze_dir: "/home/username/.local/share/kstars/analyze"

# Report level: minimal, standard, detailed
discord_report_level: "standard"  # or "minimal" or "detailed"

# Log level (optional)
log_level: "INFO"
```

### Advanced Options (Optional)

```yaml
# Alert thresholds (optional customization)
alert_thresholds:
  hfr_drift_warning: 0.5        # pixels
  temperature_swing_warning: 5.0 # Â°C
  success_rate_warning: 0.8     # 80%

# Notification preferences
notifications:
  performance_alerts: true
  min_captures_for_report: 1
  include_quality_score: true   # for detailed level
```

### Configuration Examples

```yaml
# For beginners (simple notifications)
discord_report_level: "standard"

# For data lovers (full analysis with correlations)
discord_report_level: "detailed"  # Analytics automatically enabled!

# For monitoring/automation
discord_report_level: "minimal"
notifications:
  min_captures_for_report: 5
```

## ğŸ”§ Usage

### Development and Testing
```bash
# Safe testing with dry-run (RECOMMENDED)
pipenv run python nightly_summary.py -c config.yml --dry-run

# Verbose mode for debugging
pipenv run python nightly_summary.py -c config.yml --dry-run --verbose
```

### Production Use
```bash
# Send summary to Discord
pipenv run python nightly_summary.py -c config.yml

# With verbose output
pipenv run python nightly_summary.py -c config.yml --verbose
```

### Automation
Add to your crontab for daily summary at 8 AM:
```bash
0 8 * * * cd /path/to/astro-session-analyser && pipenv run python nightly_summary.py -c config.yml
```

## ğŸ“Š What Gets Analyzed

### All Levels Include
- **Captures**: Count, duration, filters used, HFR and star statistics
- **Session Conditions**: Temperature stability, mount tracking status
- **Autofocus**: Session count, temperature, focus stability assessment
- **Issues**: Aborted captures, session problems

### DETAILED Level Adds
- **Quality Analysis**: HFR stability index, seeing conditions, trend analysis
- **Performance Metrics**: Success rate, productivity score (0-100)
- **Efficiency Analysis**: Imaging time vs total session time, downtime breakdown
- **Temperature Correlations**: Statistical analysis of temperature effects on HFR
- **Scientific Scoring**: Quality scores with statistical significance testing
- **Intelligent Alerts**: Advanced performance warnings and recommendations

## ğŸ“± Discord Summary Examples

### Standard Format
```
ğŸ”­ Ekos Session Summary
ğŸ“… 2025-07-31 18:12 UTC

ğŸŒ™ Session Overview
ğŸ“¸ Total Captures: 31
â° Duration: 11:41 â†’ 17:37 (5h 55m)
ğŸŒ¡ï¸ Temperature: 15.8Â°C â†’ 20.9Â°C (avg 17.0Â°C)
ğŸ¯ Objects: 1 | ğŸ” Filters: 3 (H, O, S)

ğŸ“Š Capture Details
ğŸ“Œ 2025-07-30 - H (11 frames, 1h 49m)
   ğŸ”§ HFR: 3.60 â†’ 5.62 (avg 4.64)
   â­ Stars: 249 â†’ 250 (avg 250)

ğŸŒ¤ï¸ Session Conditions
ğŸŒ¡ï¸ Temperature Stability: Variable (Î”5.1Â°C)
ğŸ”­ Mount Tracking: Monitoring enabled

ğŸ¯ Autofocus Summary
ğŸ”„ Sessions: 9
ğŸŒ¡ï¸ Average Temperature: 17.1Â°C
ğŸ“ˆ Focus Stability: Frequent adjustments

âš ï¸ Issues & Alerts
âŒ Aborted Captures: 4
```

### Detailed Format (Data Lover Mode)
```
ğŸ”¬ Detailed Ekos Analysis
ğŸ“… 2025-07-31 18:12 UTC

ğŸŒ™ Session Overview
ğŸ“¸ Total Captures: 31
â° Duration: 11:41 â†’ 17:37 (5h 55m)
ğŸŒ¡ï¸ Temperature: 15.8Â°C â†’ 20.9Â°C (avg 17.0Â°C) (Stability: 0%)
ğŸ¯ Objects: 1 | ğŸ” Filters: 3 (H, O, S)
â­ Session Quality Score: 60/100

ğŸ“Š Capture Details
ğŸ“Œ 2025-07-30 - H (11 frames, 1h 49m)
   ğŸ”§ HFR: 3.60 â†’ 5.62 (avg 4.64, Ïƒ 0.66)
   â­ Stars: 249 â†’ 250 (avg 250, consistency 1.00)

ğŸ“Š Image Quality Analysis
ğŸ”§ HFR: 1.96 â†’ 5.62 (avg 3.06)
ğŸ‘ï¸ Seeing Conditions: Average

ğŸŒ¤ï¸ Session Conditions
ğŸŒ¡ï¸ Temperature Stability: Variable (Î”5.1Â°C)
ğŸ”­ Mount Tracking: Monitoring enabled

ğŸ¯ Autofocus Summary
ğŸ”„ Sessions: 9
ğŸŒ¡ï¸ Average Temperature: 17.1Â°C
ğŸ“ˆ Focus Stability: Frequent adjustments

ğŸ¯ Performance Analysis
âœ… Success Rate: 88.6%
ğŸ“ˆ Productivity Score: 89/100

âš¡ Session Efficiency
ğŸ“¸ Imaging Efficiency: 87.2%

âš ï¸ Issues & Alerts
âŒ Aborted Captures: 4
```

## ğŸ—‚ï¸ Project Structure

```
astro-session-analyser/
â”œâ”€â”€ nightly_summary.py              # Main CLI script
â”œâ”€â”€ ekos_analyzer.py                # Ekos file analyzer
â”œâ”€â”€ ekos_discord_formatter.py       # Unified Discord formatter (all levels)
â”œâ”€â”€ advanced_metrics.py             # Advanced statistical calculations
â”œâ”€â”€ utils.py                        # Utilities (config, logging)
â”œâ”€â”€ config.yml                      # User configuration
â”œâ”€â”€ config_example.yml              # Unified configuration example
â”œâ”€â”€ Pipfile                         # Python dependencies
â””â”€â”€ README.md                       # Documentation
```

## ğŸ” Troubleshooting

### No Data Found
- Verify that KStars/Ekos generates `.analyze` files
- Check the `analyze_dir` path in configuration
- Use `--verbose` to see detailed logs

### Discord Webhook Error
- Verify the webhook URL in `config.yml`
- Test with `--dry-run` first

### Advanced Analytics Issues
- For DETAILED level, install: `pipenv install numpy scipy`
- The system gracefully falls back to basic mode if dependencies are missing
- Check console output for "advanced analytics" vs "basic analytics"

### Parsing Issues
- Check KStars/Ekos version (tested with 3.7.7+)
- Enable verbose mode: `--verbose`
- Use dry-run for safe testing: `--dry-run`

## ğŸ¯ Use Cases

### **Beginners** â†’ STANDARD Level
- Comprehensive information without complexity
- All essential metrics included
- Easy to understand format

### **Data Lovers** â†’ DETAILED Level  
- Statistical analysis with correlations
- Quality and efficiency scoring
- Scientific metrics with significance testing
- Performance optimization insights

### **Monitoring** â†’ MINIMAL Level
- Quick notifications for automation
- Essential info only
- Perfect for webhooks and alerts

## ğŸ”¬ Advanced Analytics (DETAILED Level)

### Automatic Features
When you select `discord_report_level: "detailed"`, the system automatically enables:

- **Statistical Correlations**: Temperature-HFR analysis with significance testing
- **Quality Scoring**: Objective 0-100 scores for session quality and productivity
- **Efficiency Analysis**: Imaging time vs downtime breakdown
- **Trend Analysis**: HFR stability and degradation detection
- **Performance Metrics**: Success rates and filter-specific analysis
- **Intelligent Alerts**: Automatic detection of issues and recommendations

### Dependencies
The detailed level requires scientific Python libraries:
```bash
pipenv install numpy scipy
```

## ğŸ§ª Development

### Safe Testing
Always use dry-run mode during development:
```bash
# Test without sending to Discord
pipenv run python nightly_summary.py -c config.yml --dry-run --verbose
```

### Architecture
- **Unified System**: Single formatter handles all report levels
- **Automatic Scaling**: Detailed level automatically enables advanced features
- **Graceful Degradation**: Falls back to basic mode if dependencies missing
- **Extensible**: Easy to add new metrics and analyses

## ğŸ¤ Contributing

Contributions are welcome! The project uses:
- **Python 3.7+** with Pipenv
- **NumPy/SciPy** for advanced analytics
- **Clear separation** between basic and advanced features

## ğŸ“„ License

This project is under MIT license. See LICENSE file for details.

## ğŸ™ Acknowledgments

- KStars/Ekos team for excellent astrophotography software
- Discord community for feedback and suggestions
- NumPy/SciPy communities for statistical computing tools

## ğŸš€ Latest Updates

- **Simplified Architecture**: Single formatter, single configuration
- **3 Clear Levels**: minimal, standard, detailed (no more complexity)
- **Auto-Activation**: Detailed level automatically enables advanced analytics
- **Dry-Run Support**: Safe testing with `--dry-run` flag
- **Unified Dependencies**: NumPy/SciPy only needed for detailed level
- **Better Error Handling**: Graceful fallback and clear error messages

Perfect scaling from simple notifications to advanced data science! ğŸ¯
